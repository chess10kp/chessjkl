import React, { useEffect, useRef, useState } from "react";
import "./Board.css";
import Square from "./Square.js"
import fenToArr from "../utils.js";

import { Chess } from "chess.js";

const Board = () => {
  const chess = new Chess();
  const [board, setBoard] = useState(fenToArr(chess.fen()));
  const [highlight, setHighlight] = useState(false);
  const [highlightedSquare, setHighlightedSquare] = useState([]);
  const [activePieceSquare, setActivePieceSquare] = useState(null);
  const [activePiece, setActivePiece] = useState(null);
  const boardref = useRef(null);
  const [turnToMove, setTurnToMove] = useState(1) // 1 is white, and 0 is black to move


  function onPieceClick(e) {
    const classList = e.target.className.split(" ");
    const xCoord = (Math.floor((e.clientX - boardref.current.getBoundingClientRect().x)/50))
    const yCoord = (Math.floor((e.clientY - boardref.current.getBoundingClientRect().y)/45))
    if (classList.includes("piece")) {
      setActivePieceSquare([xCoord ,yCoord])
      setActivePiece(board[yCoord][xCoord])
      setHighlightedSquare([xCoord, yCoord]);
      console.log(activePiece)
    }
    else {
      if (activePieceSquare) {
        const boardState = board
        boardState[yCoord][xCoord] = boardState[activePieceSquare[1]][activePieceSquare[0]] 
        boardState[activePieceSquare[1]][activePieceSquare[0]]  = ""
        setBoard(boardState)
        setHighlightedSquare([]);
        console.log(activePiece)
      }
    }
  }
  return (
    <div ref={boardref} className="board" onMouseDown={onPieceClick}>
      {board.map((rank, rankIndex) => (
        <div key={rankIndex}>
          {rank.map((_file, fileIndex) => (
            <Square
              board={board}
              highlight={highlightedSquare}
              rank={rankIndex}
              file={fileIndex}
              key={`${fileIndex}-${rankIndex}`}
            />
          ))}
        </div>
      ))}
    </div>
  );
};

export default Board;
